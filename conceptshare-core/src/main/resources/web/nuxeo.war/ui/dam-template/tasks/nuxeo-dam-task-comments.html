<dom-module id="nuxeo-dam-task-comments">
  <template>
    <style>
      .properties {
        column-count: 1;
        -moz-column-count: 1; /* Firefox */
        -webkit-column-count: 1; /* webkit, Safari, Chrome */
      }
      .properties nuxeo-user-tag {
        width:10em;
        min-width:10em;
        overflow: hidden;
        text-overflow: ellipsis;
      }
      .item {
        @apply(--layout-horizontal);
        @apply(--layout-flex);
        @apply(--layout-horizontal);
        @apply(--layout-flex);
        line-height: 1.5em;
        margin-bottom: 4px;
      }
    </style>

    <div class="box">
      <div class="properties">
        <template is="dom-repeat" items="[[comments]]">
          <div class="item">
            <nuxeo-user-tag user="[[item.user]]"></nuxeo-user-tag>
            <div>[[item.text]]</div>
          </div>
        </template>
      </div>
    </div>

  </template>
  <script>
  Polymer({
    is: 'nuxeo-dam-task-comments',
    behaviors: [Nuxeo.LayoutBehavior],
    properties: {
      task: {
        type: Object,
        observer: '_onTaskChanged'
      },
      comments: {
        type: Array,
        value: function() {
          return [];
        }
      }
    },

    _onTaskChanged:function() {
      var comments= [];
      var source = this.task.variables.comments;
      source.forEach(function(item) {
        var index = item.indexOf(':');
        if (index>0) {
          comments.push({
            user: item.substring(0,index),
            text: item.substring(index+1)
          });
        }
      });
      this.set('comments',comments);
    }

  });
  </script>
</dom-module>

