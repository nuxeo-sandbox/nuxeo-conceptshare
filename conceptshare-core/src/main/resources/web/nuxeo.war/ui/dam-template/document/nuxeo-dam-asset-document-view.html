<link rel="import" href="nuxeo-dam-asset-view.html">
<!--
`custom-document-view`
@group Nuxeo UI
@element custom-document-view
-->
<dom-module id="nuxeo-dam-asset-document-view">
  <template>
    <style>
    </style>
    <nuxeo-dam-asset-view document="{{document}}" display-actions></nuxeo-dam-asset-view>
  </template>

  <script>
  (function() {
    'use strict';
    Polymer({
      is: 'nuxeo-dam-asset-document-view',
      behaviors: [Nuxeo.LayoutBehavior],
      properties: {
        title: {
          type: String,
          value: 'Title'
        },

        edit: {
          type: Boolean,
          value: false
        },

        isProcessingTask: {
          type: Boolean,
          value: false,
          reflectToAttribute: true,
          notify: true
        },

        //You can use either @schema or @doctype annotation in your model
        /**
        * @schema dublincore
        */
        document: {
          type: Object,
          observer: '_documentChanged'
        }
      },

      listeners: {
        'workflowTaskProcess': '_workflowTaskProcess',
        'workflowTaskCancelled': '_workflowTaskCancelled'
      },

      _documentChanged: function() {
        if (this.document) {
          this.edit = false;
          this.isProcessingTask = false;
        }
      },

      _isMutable: function(doc) {
        return !this.hasFacet(doc, 'Immutable') && doc.type !== 'Root' && doc.state !== 'deleted';
      },

      _canEdit: function(doc) {
        return doc && doc.type !== 'Root' && this.hasPermission(doc, 'Write') && this._isMutable(doc);
      },

      _editMode: function() {
        this.edit = true;
      },

      _workflowTaskProcess: function() {
        this.isProcessingTask = true;
      },

      _workflowTaskCancelled: function() {
        this.isProcessingTask = false;
      },

      isPicture: function(document) {
        return document.facets.indexOf('Picture')>=0;
      }

    });
  })();
  </script>
</dom-module>
