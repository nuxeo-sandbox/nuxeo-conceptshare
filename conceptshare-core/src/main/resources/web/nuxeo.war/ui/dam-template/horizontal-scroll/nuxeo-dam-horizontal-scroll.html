<script type="text/javascript" src="../scripts/sly.js"></script>

<dom-module id="nuxeo-dam-horizontal-scroll">
  <template>
    <style>
      .wrap {
        height: 100%;
      }
      /* Frame */
      .frame {
        height: 100%;
        overflow: hidden;
      }
      .frame #slidee {
        margin: 0;
        padding: 0;
        height: 100%;
      }
    </style>
    <div id="wrap" class="wrap">
      <div id="frame" class="frame">
        <div id="slidee">
          <content id="items"></content>
        </div>
      </div>
    </div>

  </template>
  <script>
  (function() {
    Polymer({
      is: 'nuxeo-dam-horizontal-scroll',
      properties: {},

      behaviors: [
        Polymer.IronResizableBehavior
      ],

      listeners: {
        /**
           * Everytime a width dimension of the gallery space changes,
           * the gallery needs to be recalculated.
           * Function is called every-time the window resizes (and once at the page load,
           * more details: https://elements.polymer-project.org/elements/iron-resizable-behavior?active=Polymer.IronResizableBehavior)
           */
        'iron-resize': '_redraw'
      },

      ready: function() {
        var context = this;
        console.log("-- nuxeo-dam-horizontal-scroll ready");
        // Call Sly on frame
        this.sly = new Sly(this.$.frame,{
          horizontal: 1,
          itemSelector: 'nuxeo-dam-horizontal-scroll-item',
          itemNav: 'basic',
          smart: false,
          activateOn: 'click',
          mouseDragging: 1,
          touchDragging: 1,
          releaseSwing: 1,
          startAt: 0,
          speed: 300,
          elasticBounds: 1,
          dragHandle: 1,
          dynamicHandle: 1,
          scrollBy: 1,
          scrollHijack: 50,
          scrollTrap: true
        });
        this.sly.init();
        Polymer.dom(this.$.items).observeNodes(function(info) {
          console.log('dom changed',info);
          context._redraw();
        });
      },

      _redraw: function() {
        // Avoid race condition on initial load: the data might be set
        // before the width of the element is known
        this.debounce('redraw', function() {
          this._renderScroll();
        },100);
      },

      _renderScroll: function() {
        var items = Polymer.dom(this).querySelectorAll('nuxeo-dam-horizontal-scroll-item');
        items.forEach(function(item) {
          item.updateDimensions();
        });
        this.sly.reload();
      }

    });
  })();
  </script>
</dom-module>
