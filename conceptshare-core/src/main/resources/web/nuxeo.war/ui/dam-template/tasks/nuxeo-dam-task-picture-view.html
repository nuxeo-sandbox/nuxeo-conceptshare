<link rel="import" href="../document-widgets/nuxeo-dam-document-info.html">
<link rel="import" href="../document-widgets/nuxeo-dam-document-collections.html">
<link rel="import" href="../document-widgets/nuxeo-dam-document-exif-metadata.html">
<link rel="import" href="../document-widgets/nuxeo-dam-document-iptc-metadata.html">
<link rel="import" href="../document-widgets/nuxeo-dam-document-info-bar.html">
<link rel="import" href="../document-widgets/nuxeo-dam-annotation-viewer.html">

<!--
`custom-document-view`
@group Nuxeo UI
@element custom-document-view
-->
<dom-module id="nuxeo-dam-task-picture-view">
  <template>
    <style>

      .viewer {
        height:70vh;
        margin-left:16px;
        margin-right:16px;
      }

      nuxeo-dam-annotation-viewer {
        height:100%;
        width:100%;
      }

      .container {
        justify-content: space-around;
      }

      .item {
        min-width: 350px;
        margin: 16px;
      }

      .metadata {
        flex: 1 100%;
        margin: 16px;
      }

      .relative {
        position: relative;
      }

      paper-card {
        border-style: none;
        padding: 8px;
        height: 100%;
      }

      .title-text {
        padding: 16px;
        font-size: 24px;
        font-weight: 400;
        display: inline-block;
      }

      #edit {
        display: inline-block;
      }

      img {
        height: 100%;
        height: 70vh;
        margin: 0 auto;
        display: block;
      }

    </style>

    <div class="viewer">
      <nuxeo-dam-annotation-viewer doc-id="[[document.uid]]"></nuxeo-dam-annotation-viewer>
    </div>

    <div class="layout horizontal wrap container">
      <div class="item flex">
        <paper-card elevation="0" hidden$="[[edit]]">
          <div class="layout horizontal" style="align-items: center;">
            <div class="title-text">
              Metadata
            </div>
            <paper-icon-button id="edit" icon="editor:mode-edit" on-tap="_editMode" hidden$="[[!_canEdit(document)]]"></paper-icon-button>
          </div>
          <div class="card-content">
            <nuxeo-document-metadata document="[[document]]"></nuxeo-document-metadata>
          </div>
        </paper-card>
        <paper-card hidden$="[[!edit]]" heading="Metadata" elevation="0">
          <div class="card-content">
            <nuxeo-document-edit document="[[document]]"></nuxeo-document-edit>
          </div>
        </paper-card>
      </div>
      <div class="item flex">
        <paper-card heading="Image Properties" elevation="0">
          <div class="card-content">
            <nuxeo-picture-info document="[[document]]"></nuxeo-picture-info>
          </div>
        </paper-card>
      </div>
      <div class="item flex">
        <paper-card heading="Tags" elevation="0">
          <div class="card-content">
            <nuxeo-tag-suggestion
                                  document="[[document]]"
                                  allow-new-tags
                                  placeholder="[[i18n('documentPage.tags.placeholder')]]"
                                  readonly="[[_canEdit(document)]]">
            </nuxeo-tag-suggestion>
          </div>
        </paper-card>
      </div>
      <div class="item flex">
        <paper-card heading="Collections" elevation="0">
          <div class="card-content">
            <nuxeo-dam-document-collections document="[[document]]"></nuxeo-dam-document-collections>
          </div>
        </paper-card>
      </div>

      <div class="metadata flex">
        <paper-card elevation="0" heading="Renditions">
          <div class="card-content">
            <nuxeo-picture-formats role="widget" document="[[document]]"></nuxeo-picture-formats>
          </div>
        </paper-card>
      </div>

      <div class="item flex">
        <paper-card heading="System Information" elevation="0">
          <div class="card-content">
            <nuxeo-dam-document-info document="[[document]]"></nuxeo-dam-document-info>
          </div>
        </paper-card>
      </div>
      <div class="metadata flex">
        <paper-card elevation="0" heading="Embedded EXIF">
          <div class="card-content">
            <nuxeo-dam-document-exif-metadata document="[[document]]"></nuxeo-dam-document-exif-metadata>
          </div>
        </paper-card>
      </div>
      <div class="metadata flex">
        <paper-card elevation="0" heading="Embedded IPTC">
          <div class="card-content">
            <nuxeo-dam-document-iptc-metadata document="[[document]]"></nuxeo-dam-document-iptc-metadata>
          </div>
        </paper-card>
      </div>
    </div>

  </template>

  <script>
  (function() {
    'use strict';
    Polymer({
      is: 'nuxeo-dam-task-picture-view',
      behaviors: [Nuxeo.LayoutBehavior],
      properties: {
        document: {
          type: Object,
          observer: '_documentChanged'
        },
        edit: {
          type: Boolean,
          value: false
        }
      },

      _documentChanged: function() {
        if (this.document) {
          this.edit = false;
        }
      },

      _isMutable: function(doc) {
        return !this.hasFacet(doc, 'Immutable') && doc.type !== 'Root' && doc.state !== 'deleted';
      },

      _canEdit: function(doc) {
        return doc && doc.type !== 'Root' && this.hasPermission(doc, 'Write') && this._isMutable(doc);
      },

      _editMode: function() {
        this.edit = true;
      }

    });
  })();
  </script>
</dom-module>
