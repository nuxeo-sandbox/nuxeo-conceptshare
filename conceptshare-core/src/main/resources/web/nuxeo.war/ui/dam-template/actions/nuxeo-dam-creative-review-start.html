<dom-module id="nuxeo-dam-creative-review-start">
  <template>

    <style>
      :host {
        display: inline-block;
      }

      ::content iron-icon:hover {
        fill: var(--nuxeo-link-hover-color);
      }

      .hidden {
        display: none;
      }

      .show {

      }

    </style>

    <nuxeo-operation
        id="workflow"
        op="javascript.api_bulk_start_creative_review"
        input="{{input}}"
        on-response="_handleResponse">
    </nuxeo-operation>
    <paper-icon-button noink
      id="clipboardButton"
      icon="icons:gavel"
      class$="[[_show(document)]]">
    </paper-icon-button>
    <paper-tooltip for="clipboardButton">[[i18n('Start Creative Review')]]</paper-tooltip>
    <paper-toast id="toast"></paper-toast>

  </template>

  <script>
    (function() {
      'use strict';
      Polymer({
        is: 'nuxeo-dam-creative-review-start',
        properties: {
          documents: {
            type: Array,
            notify: true,
            value: []
          },
          document: {
            type: Object,
            notify: true
          }
        },
        behaviors: [Nuxeo.I18nBehavior],

        listeners: {
          'tap': '_startCreativeReview'
        },

        _startCreativeReview: function() {
          var ids = [];
          if (this.document) {
            ids.push(this.document.uid);
          } else {
            this.documents.forEach(function(item) {
              ids.push(item.uid);
            });
          }
          this.input = 'docs:'+ids.join(',');
          this.$.workflow.execute();
        },

        _toast: function(text) {
          this.$.toast.hide();
          this.$.toast.text = text;
          this.$.toast.open();
        },

        _handleResponse: function(e) {
          this._toast(
            this.i18n('Creative Review Started')
          );
          this.fire('workflowStarted');
        },

        _show:function(doc) {
          if (this.document) {
            return this.document.state === 'draft' ? 'show' : 'hidden';
          } else {
            return 'show';
          }
        }

      });
    })();
  </script>

</dom-module>
