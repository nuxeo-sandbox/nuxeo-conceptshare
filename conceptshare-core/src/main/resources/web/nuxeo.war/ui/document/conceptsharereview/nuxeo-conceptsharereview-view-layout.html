<!--
`nuxeo-conceptsharereview-view-layout`
@group Nuxeo UI
@element nuxeo-conceptsharereview-view-layout
-->
<dom-module id="nuxeo-conceptsharereview-view-layout">
  <template>
    <style>
      :host {
        display: inline-block;
        position: relative;
        box-sizing: border-box;
        width: 100%;
        min-height: 40vh;
      }
    </style>

    <nuxeo-page-provider id="provider"
                         provider="ordered_content_collection"
                         schemas="dublincore,common"
                         enrichers="thumbnail, permissions">
    </nuxeo-page-provider>

    <nuxeo-default-results id="results"
                           items="{{items}}"
                           on-navigate="_navigate"
                           selected-items="{{selectedItems}}"
                           empty-label="[[i18n('collections.noDocument')]]"
                           empty-label-when-filtered="[[i18n('collections.noDocumentWhenFiltered')]]"
                           hide-content-view-actions>
      <div class="selectionActions">
        <nuxeo-slot slot="COLLECTION_ACTIONS"
                    model="[[actionContext]]"></nuxeo-slot>
      </div>
    </nuxeo-default-results>
  </template>

  <script>
    Polymer({
      is: 'nuxeo-conceptsharereview-view-layout',
      behaviors: [Nuxeo.LayoutBehavior, Nuxeo.FiltersBehavior],
      properties: {
        /**
         * @doctype Collection
         */
        document: {
          type: Object,
          observer: '_documentChanged'
        },
        actionContext: {
          type: Object,
          computed: '_actionContext(document, selectedItems)'
        }
      },

      _documentChanged: function() {
        if (this.document && this.hasFacet(this.document, 'Collection')) {
          this.$.results.nxProvider = this.$.provider;
          this.$.provider.params = [this.document.uid];
          this.$.provider.page = 1;
          this.fire('collection-loaded', {
            collection: document,
            provider: this.$.provider
          });
          this.$.provider.fetch();
        }
      },

      _actionContext: function() {
        return {
          collection: this.document,
          selectedItems: this.selectedItems,
          items: this.$.results.items
        };
      },

      _navigate: function(e) {
        this.fire('navigate', {
          doc: e.detail.doc,
          srcDoc: this.document,
          isFromCollection: true
        });
        e.stopPropagation();
      }
    });
  </script>
</dom-module>
